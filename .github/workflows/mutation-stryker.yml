name: CI (mutation-stryker)

on:
  push:
    branches: ["main", "master"]
  pull_request:

jobs:
  mutation:
    runs-on: ubuntu-latest
    timeout-minutes: 30

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup .NET (from global.json)
        uses: actions/setup-dotnet@v4
        with:
          global-json-file: global.json

      - name: Restore
        run: dotnet restore

      - name: Build
        run: dotnet build -c Release --no-restore

      - name: Install Stryker.NET
        run: |
          dotnet tool install -g dotnet-stryker --version 4.9.1 || dotnet tool update -g dotnet-stryker
          echo "$HOME/.dotnet/tools" >> $GITHUB_PATH

      # IMPORTANT: run from repo root so paths in stryker-config.json resolve correctly
      - name: Run Stryker (UnitTests)
        working-directory: ${{ github.workspace }}
        run: dotnet stryker --config-file stryker-config.json --log-to-file

      - name: Upload Stryker report (always)
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: stryker-report
          path: |
            **/StrykerOutput/**
            **/stryker.log
